var App={win:$(window),doc:$(document),max_mobile_width:1024,is_mobile:detectmob(),ms_ie:/(MSIE|Trident\/|Edge\/)/i.test(navigator.userAgent)};function detectmob(){return!!(navigator.userAgent.match(/Android/i)||navigator.userAgent.match(/webOS/i)||navigator.userAgent.match(/iPhone/i)||navigator.userAgent.match(/iPad/i)||navigator.userAgent.match(/iPod/i)||navigator.userAgent.match(/BlackBerry/i)||navigator.userAgent.match(/Windows Phone/i))}function debounce(i,o,s){var r;return function(){var e=this,t=arguments,n=s&&!r;clearTimeout(r),r=setTimeout(function(){r=null,s||i.apply(e,t)},o),n&&i.apply(e,t)}}function fileBoxesInit(e){Array.prototype.forEach.call(e,function(e){var n=e.parentNode,i=n.innerHTML;e.addEventListener("change",function(e){var t="";(t=this.files&&1<this.files.length?(this.getAttribute("data-multiple-caption")||"").replace("{count}",this.files.length):e.target.value.split("\\").pop())?n.querySelector("span").innerHTML=t:n.innerHTML=i}),e.addEventListener("focus",function(){e.classList.add("has-focus")}),e.addEventListener("blur",function(){e.classList.remove("has-focus")})})}function validate_area_fields(){var e=0;$('[name*="area"]').each(function(){$(this).attr("name","area_"+e++),$(this).rules("add",{required:!0,number:!0,messages:{required:"обязательно для заполнения",number:"только числовое значение"}})})}App.HeaderMenuMobile=function(){function e(){this.render()}var s;e.prototype={el:{sidr_selector:".sidr",h_menu_selector:".h-menu",mobile_btn_selector:".mobile-mainmenu-btn",sidr_class:"sidr-mobile-mainmenu"},render:function(){if(s=this,!$(s.el.mobile_btn_selector).length)return!1;s.sidrInit(),s.sidrSwipe(),s.sidrResize()},sidrInit:function(){if(void 0!==$.fn.sidr){$(s.el.mobile_btn_selector).sidr({name:s.el.sidr_class,source:s.el.h_menu_selector,side:"right"});var e=document.getElementsByClassName("sidr-class-active")[0].offsetTop;document.getElementById("sidr-mobile-mainmenu").scrollTop=e}else console.info("required jquery.sidr(.min).js (для мобильного меню)")},sidrClose:function(){$.sidr("close",s.el.sidr_class)},sidrSwipe:function(){void 0!==$.fn.swipe&&$(s.el.sidr_selector).swipe({excludedElements:"button, input, select, textarea, .noSwipe",swipeRight:function(e,t,n,i,o){s.sidrClose()}})},sidrResize:function(){var e=debounce(function(){App.win.width()>App.max_mobile_width&&s.sidrClose()},250);App.win.resize(e)}},new e},App.Sliders=function(){if(void 0!==$.fn.slick){function e(){this.render()}var t;e.prototype={el:{partners_slider_selector:".partners-slider",news_slider_selector:".news-slider",work_slider_selector:".work-slider",showing_slider_selector:".showing-slider"},render:function(){(t=this).partnersSlider(),t.newsSlider(),t.workSlider(),t.showingSlider()},partnersSlider:function(){$(t.el.partners_slider_selector).slick({infinite:!0,speed:300,touchThreshold:10,swipeToSlide:!0,slidesToShow:5,slidesToScroll:1,centerMode:!0,autoplay:!0,autoplaySpeed:6e3,centerPadding:"20px",responsive:[{breakpoint:1024,settings:{slidesToShow:3,slidesToScroll:1}},{breakpoint:768,settings:{slidesToShow:2,slidesToScroll:1}},{breakpoint:568,settings:{slidesToShow:1,slidesToScroll:1,centerPadding:"5px",centerMode:!1}}]})},newsSlider:function(){$(t.el.news_slider_selector).slick({infinite:!1,slidesToShow:1,dots:!0,adaptiveHeight:!0})},workSlider:function(){$(t.el.work_slider_selector).slick({infinite:!0,slidesToShow:1,dots:!0,adaptiveHeight:!0,autoplay:!0,autoplaySpeed:6e3})},showingSlider:function(){$(t.el.showing_slider_selector).slick({infinite:!0,slidesToShow:1,dots:!1,adaptiveHeight:!0})}},new e}else console.info("required slick(.min).js (для слайдеров, каруселей)")},App.Share=function(){var e="Фонд МКД",t="toolbar=0,status=0,width=626,height=436";App.doc.on("click",".js-link--share",function(){switch($(this).data("share-type")){case"facebook":url="http://www.facebook.com/sharer.php?s=100",url+="&p[title]="+encodeURIComponent(e),url+="&p[url]="+encodeURIComponent($(this).data("share-url")),window.open(url,"",t);break;case"vkontakte":url="http://vkontakte.ru/share.php?",url+="url="+encodeURIComponent($(this).data("share-url")),url+="&title="+encodeURIComponent(e),url+="&noparse=true",window.open(url,"",t);break;case"twitter":url="http://twitter.com/share?",url+="text="+encodeURIComponent(e),url+="&url="+encodeURIComponent($(this).data("share-url")),url+="&counturl="+encodeURIComponent($(this).data("share-url")),window.open(url,"",t);break;case"odnoklassniki":url="http://www.odnoklassniki.ru/dk?st.cmd=addShare&st.s=1",url+="&st.comments="+encodeURIComponent(e),url+="&st._surl="+encodeURIComponent($(this).data("share-url")),window.open(url,"",t)}return!1})},App.Forms=function(){function e(){this.render()}var t;e.prototype={el:{datepicker_selector:".js-datepicker",datepicker_time_selector:".js-datepicker-time"},render:function(){(t=this).datepickerInit(),App.ms_ie||t.checkBox(),t.fileBoxes(),t.copyBlock(),t.Alerts(),t.viewDoc(),t.fieldControls()},datepickerInit:function(){if(void 0!==$.fn.pikaday){var e={previousMonth:"Предыдущий месяц",nextMonth:"Следующий месяц",months:["Январь","Февраль","Март","Апрель","Май","Июнь","Июль","Август","Сентябрь","Октябрь","Ноябрь","Декабрь"],weekdays:["Воскресенье","Понедельник","Вторник","Среда","Четверг","Пятница","Суббота"],weekdaysShort:["Вс","Пн","Вт","Ср","Чт","Пт","Сб"]};$(t.el.datepicker_time_selector).pikaday({firstDay:1,format:"DD.MM.YYYY HH:mm",yearRange:[1950,2005],use24hour:!0,showSeconds:!1,i18n:e}),$(t.el.datepicker_selector).pikaday({firstDay:1,format:"DD.MM.YYYY",yearRange:[1950,2005],showTime:!1,i18n:e})}else console.info("required pikaday.js (для выбора даты)")},checkBox:function(){App.doc.on("change",'input[type="checkbox"]',function(){$('input[type="checkbox"]').parent("label").css("pointer-events","none"),setTimeout(function(){$('input[type="checkbox"]').parent("label").css("pointer-events","auto")},1e3)})},fileBoxes:function(){fileBoxesInit($(".inputfile"))},copyBlock:function(){App.doc.on("click",".js--copy-block",function(){var e=$(this).parent("div").prev(".copy-block").removeClass("copy-block").clone().hide();e.find("input").val(""),e.find(".file-box span").text(""),e.addClass("copy-block").insertBefore($(this).parent("div")).slideDown(),fileBoxesInit(e.find(".inputfile")),e.find('[name*="area"]').length&&(e.find("label.error").remove(),validate_area_fields())}),App.doc.on("click",".js--delete-block",function(){var e=$(this).parents(".additional-block");e.slideUp(function(){e.remove()})})},Alerts:function(){0<$(".alert.show").length&&$("body, html").animate({scrollTop:$(".alert").first().offset().top-140},500)},viewDoc:function(){$(document).on("click",".js-link--viewdoc",function(){return $("#view-doc-iframe").attr("src")!=$(this).attr("href")&&$("#view-doc-iframe").attr("src",$(this).attr("href")),!1})},fieldControls:function(){$(document).on({mouseenter:function(){$(this).children(".field-controls__container").fadeIn()},mouseleave:function(){$(this).children(".field-controls__container").fadeOut()}},".field-controls"),$(document).on({mouseenter:function(){$("#reference-"+$(this).data("name")).fadeIn()},mouseleave:function(){$("#reference-"+$(this).data("name")).fadeOut("slow")}},".field-controls-btn-reference"),$(document).on("click",".field-controls-btn-reset",function(){return $('[name="'+$(this).data("name")+'"]').val(""),$('select[name="'+$(this).data("name")+'"]').trigger("chosen:updated"),!1})}},new e},App.Selects=function(){$(".select-block:not(.decorated)").prepend('<span class="arr"></span>').addClass("decorated"),$(".chosen-extra .select-chosen").on("chosen:ready",function(){$(this).siblings(".chosen-container").find(".chosen-search").append('<button class="btn btn-chosen-extra" data-select-name="'+$(this).attr("name")+'">добавить</button>')}),$(".select-chosen").chosen({disable_search_threshold:0,no_results_text:"Ничего не найдено"}),App.doc.on("keyup",".chosen-extra .chosen-search-input",function(){console.log($(this).parent(".chosen-search").siblings(".chosen-results").children(".no-results").length),1==$(this).parent(".chosen-search").siblings(".chosen-results").children(".no-results").length?$(this).siblings(".btn-chosen-extra").show():$(this).siblings(".btn-chosen-extra").hide()}),App.doc.on("click",".btn-chosen-extra",function(){var e=$(this).siblings(".chosen-search-input").val(),t=$(this).data("select-name");console.log(e),console.log(t),$('select[name="'+t+'"]').append("<option value='"+e+"'>"+e+"</option>"),$('select[name="'+t+'"]').val(e),$('select[name="'+t+'"]').trigger("chosen:updated")}),App.doc.on("click",'[type="reset"]',function(){$(".select-chosen").val("").trigger("chosen:updated")})},App.Media=function(){$("video, audio").mediaelementplayer({})},App.Print=function(){App.doc.on("click",".js-link--print",function(){return window.print?window.print():alert("Ваш браузер не поддерживает js-функцию печати. Нажмите Ctrl+P"),!1})},$.validator.methods.number=function(e,t){return this.optional(t)||/^-?(?:\d+|\d{1,3}(?:[\s\.,]\d{3})+)(?:[\.,]\d+)?$/.test(e)},$(document).ready(function(){App.HeaderMenuMobile(),App.Sliders(),App.Share(),App.Forms(),App.Media(),App.Print(),App.Selects(),$('[data-toggle="popover"]').popover(),$(".form").on("hide.bs.modal",function(){$("video, audio").each(function(){this.pause()});var e=$(this).find("iframe"),t=e.attr("src");e.attr("src",t)})});